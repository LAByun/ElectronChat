import{r as i,o as j,c as d,a as o,n as h,F as H,p as M,q as O,b as c,t as I,v as K,u as x,E as P,w as T,x as z,e as k,f as l,y as f,z as F,A as J,i as L,B as q}from"./index-B5Mw5UAC.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"chat-container"},G={class:"chat-messages"},R=["innerHTML"],U={key:0},Q={key:0,style:{width:"80vw"}},X={key:0,class:"typing-wrapper"},Y={class:"input-area"},Z={class:"input-wrapper"},$={__name:"TableHome",setup(ee){const n=i(""),a=i([]),B=i(!1);i("");const r=i(0),E=t=>{t.shiftKey||m()},m=async()=>{const t=n.value.trim();t&&(a.value.push({sender:"你",text:t}),r.value=r.value+1,n.value="",a.value.push({sender:"AI",text:"正在思考中...",text1:`参考这个图片<br/><img src="http://127.0.0.1:9000/knowledge/%E5%85%88%E8%BF%9B%E4%B8%AA%E4%BA%BA_00.jpg" alt="动态添加的图片" style="width: 100px;"><br/><table><thead><tr><th style='  border: 1px solid rgb(160 160 160);'>内容部分</th><th style='  border: 1px solid rgb(160 160 160);'>字体</th><th style='  border: 1px solid rgb(160 160 160);'>字号</th><th style='  border: 1px solid rgb(160 160 160);'>行距</th><th style='  border: 1px solid rgb(160 160 160);'>首行缩进</th></tr></thead><tbody><tr><td style='  border: 1px solid rgb(160 160 160);'>正文</td><td style='  border: 1px solid rgb(160 160 160);'>宋体或微软雅黑</td><td style='  border: 1px solid rgb(160 160 160);'>12号</td><td style='  border: 1px solid rgb(160 160 160);'>1.5倍</td><td style='  border: 1px solid rgb(160 160 160);'>2个字符</td></tr></tbody><tbody><tr><td style='  border: 1px solid rgb(160 160 160);'>一级标题</td><td style='  border: 1px solid rgb(160 160 160);'>黑体</td><td style='  border: 1px solid rgb(160 160 160);'>16号</td><td style='  border: 1px solid rgb(160 160 160);'>-</td><td style='  border: 1px solid rgb(160 160 160);'>-</td></tr></tbody><tbody><tr><td style='  border: 1px solid rgb(160 160 160);'>二级标题</td><td style='  border: 1px solid rgb(160 160 160);'>宋体加粗</td><td style='  border: 1px solid rgb(160 160 160);'>14号</td><td style='  border: 1px solid rgb(160 160 160);'>-</td><td style='  border: 1px solid rgb(160 160 160);'>-</td></tr></tbody></table>`,pdf:""}),N(),S())},S=()=>{q(()=>{const t=document.querySelector(".chat-messages");t.scrollTop=t.scrollHeight})};async function N(){const t={ask:a.value[r.value-1].text},b=(await fetch("http://localhost:5000/testPic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).body.getReader(),v=new TextDecoder;let e="";for(;;){const{done:A,value:C}=await b.read();if(A)break;e+=v.decode(C,{stream:!0});const u=e.split(`
`);for(let y=0;y<u.length-1;y++){const _=u[y].trim();if(_.startsWith("data: "))try{const g=_.slice(6),w=JSON.parse(g);console.log("实时接收:",w.response),a.value[r.value].text1=a.value[r.value].text1+w.response}catch(g){console.error("JSON解析失败:",g)}}e=u[u.length-1]}console.log(e);const p=a.value[r.value].text1.split("参考这个文件:");p.length===2&&(a.value[r.value].pdf=p[1]),r.value=r.value+1}const V=async()=>{const t=await window.versions.ping("hello yah");console.log(t)};return j(async()=>{V()}),(t,s)=>{const b=k("Position"),v=k("el-icon");return l(),d("div",W,[s[4]||(s[4]=o("div",{class:"header"},[o("div",{class:"avatar"},[o("i",{class:"fas fa-robot"})]),o("h1",null,"流程自助查询助手")],-1)),o("div",G,[(l(!0),d(H,null,M(a.value,(e,p)=>(l(),d("div",{key:p,class:f(["message-wrapper",e.sender==="你"?"user-message-wrapper":"ai-message-wrapper"])},[o("div",{class:f(["message-bubble",e.sender==="你"?"user-message":"ai-message"])},[o("div",{class:f(["content",e.sender==="你"?"":"ai-message-border"])},F(e.text),3),o("div",{class:"content",innerHTML:e.text1},null,8,R),e.sender!=="你"?(l(),d("div",U,[e.pdf!==""?(l(),d("div",Q,[c(x(J),{source:e.pdf},null,8,["source"])])):h("",!0)])):h("",!0)],2)],2))),128)),B.value?(l(),d("div",X,s[1]||(s[1]=[O('<div class="message-bubble ai-message" data-v-23402caa><div class="typing-indicator" data-v-23402caa><div class="typing-dot" data-v-23402caa></div><div class="typing-dot" data-v-23402caa></div><div class="typing-dot" data-v-23402caa></div></div></div>',1)]))):h("",!0)]),o("div",Y,[o("div",Z,[c(x(P),{modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=e=>n.value=e),placeholder:"请输入您的问题...",type:"textarea",rows:2,resize:"none",onKeydown:I(K(E,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),c(x(z),{type:"primary",class:"send-btn",onClick:m,disabled:!n.value.trim()},{default:T(()=>[c(v,{style:{"margin-right":"10px"}},{default:T(()=>[c(b)]),_:1}),s[2]||(s[2]=L(" 发送 "))]),_:1},8,["disabled"])]),s[3]||(s[3]=o("div",{class:"input-tip"},"按 Enter 键发送，Shift+Enter 换行",-1))])])}}},oe=D($,[["__scopeId","data-v-23402caa"]]);export{oe as default};
